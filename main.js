(()=>{"use strict";function e(e,t="popup_is-opened"){e.classList.toggle(t),document.addEventListener("keydown",n)}function t(e,t="popup_is-opened"){e.classList.toggle(t),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function o(e){return e.ok?e.json():Promise.reject(e.status)}function r(e,t,n="Сохранить",o="Сохранение..."){t.textContent=e?o:n}function a(e,t,n="Сохранение..."){t.preventDefault();const o=t.submitter,a=o.textContent;r(!0,o,a,n),e().then((()=>t.target.reset())).catch((e=>{console.log(`Ошибка: ${e}`)})).finally((()=>r(!1,o,a)))}const s={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"d997cce7-ebe0-4725-9847-92653316575c","Content-Type":"application/json"}};function c(e,t,n){return fetch(`${e.baseUrl}/`+t,n).then(o)}const i=e=>c(s,"cards/likes/"+e,{method:"PUT",headers:s.headers}),l=e=>c(s,"cards/likes/"+e,{method:"DELETE",headers:s.headers});let u,d;const p=document.querySelector(".popup_type_confirm"),m=document.querySelector("#card-template").content;function _(e){e.remove()}function v(e,t,n){e.classList.contains("card__like-button_is-active")?l(t).then((t=>{e.classList.remove("card__like-button_is-active"),n.textContent=t.likes.length})).catch((e=>{console.log(`Ошибка: ${e}`)})):e.classList.contains("card__like-button")&&i(t).then((t=>{e.classList.add("card__like-button_is-active"),n.textContent=t.likes.length})).catch((e=>{console.log(`Ошибка: ${e}`)}))}const f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},y=(e,t)=>Array.from(e.querySelectorAll(t)),h=(e,t)=>{const n=e.querySelector(t.submitButtonSelector),o=y(e,t.inputSelector);o.forEach((n=>{S(n,e,t)})),k(o,n,t)},S=(e,t,n)=>{const o=t.querySelector(`.${e.id}-error`);e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},b=(e,t)=>{e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?S(e,t,f):((e,t,n,o)=>{const r=t.querySelector(`.${e.id}-error`);e.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n})(e,t,e.validationMessage,f)};function k(e,t,n){!function(e){return e.some((e=>!e.validity.valid))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}let C;const E=document.querySelector(".places__list"),L=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__edit-button"),q=document.querySelector(".popup__image"),x=document.querySelector(".popup__caption"),T=document.querySelector(".popup_type_edit"),$=document.querySelector(".popup_type_new-card"),B=document.querySelector(".popup_type_image"),w=document.forms["new-place"],A=w.elements["place-name"],P=w.elements.link,M=document.forms["edit-profile"],N=M.elements.name,O=M.elements.description,j=document.querySelector(".profile__title"),D=document.querySelector(".profile__description"),J=document.querySelector(".profile__image"),U=document.querySelector(".popup_type_update_avatar"),G=document.forms["update-avatar"],H=G.elements["avatar-link"];(e=>{y(document,e.formSelector).forEach((t=>{((e,t)=>{const n=y(e,t.inputSelector),o=e.querySelector(t.submitButtonSelector);k(n,o,t),n.forEach((r=>{r.addEventListener("input",(()=>{b(r,e),k(n,o,t)}))}))})(t,e)}))})(f);const I={deleteCard:_,likeCard:v,openedImageModal:function(t,n){q.src=t,q.alt=n,x.textContent=n,e(B)}};function V(t,n="prepend"){const o=function(t,n,o){const r=m.querySelector(".places__item").cloneNode(!0),a=r.querySelector(".card__image"),s=r.querySelector(".card__title"),c=r.querySelector(".like-number"),i=r.querySelector(".card__like-button"),l=r.querySelector(".card__delete-button"),_=i.querySelector(".like-number"),f=t.likes,y=t.owner._id;return a.src=t.link,a.alt=t.name,s.textContent=t.name,c.textContent=t.likes.length,function(e,t,n){e===n&&(t.hidden=!1)}(y,l,o),f.forEach((e=>function(e,t,n,o="card__like-button_is-active"){e===t&&n.classList.add(o)}(e._id,o,i))),i.addEventListener("click",(()=>v(i,t._id,_))),l.addEventListener("click",(n=>{u=t._id,d=n.target.closest(".places__item"),e(p)})),a.addEventListener("click",(()=>n.openedImageModal(t.link,t.name))),r}(t,I,C);E[n](o)}J.addEventListener("click",(()=>{G.reset(),h(G,f),e(U)})),g.addEventListener("click",(()=>{N.value=j.textContent,O.value=D.textContent,h(M,f),e(T)})),L.addEventListener("click",(()=>{w.reset(),h(w,f),e($)}));const z={atCross:"popup__close",atBackdrop:"popup"};Array.from(document.querySelectorAll(".popup")).forEach((e=>function(e,n){e.addEventListener("click",(o=>{(o.target.classList.contains(n.atCross)||o.target.classList.contains(n.atBackdrop))&&t(e)}))}(e,z))),$.addEventListener("submit",(function(e){a((function(){return(e=A.value,n=P.value,c(s,"cards",{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:n})})).then((e=>(V(e),void t($))));var e,n}),e,"Созданение...")})),T.addEventListener("submit",(function(e){a((function(){return(e=N.value,n=O.value,c(s,"users/me",{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:n})})).then((e=>{return n=e.name,o=e.about,j.textContent=n,D.textContent=o,void t(T);var n,o}));var e,n}),e)})),U.addEventListener("submit",(function(e){a((function(){return(e=H.value,c(s,"users/me/avatar",{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})})).then((e=>{return n=e.avatar,J.style=`background-image: url('${n}')`,void t(U);var n}));var e}),e)})),p.addEventListener("submit",(function(e){a((function(){return(e=u,c(s,"cards/"+e,{method:"DELETE",headers:s.headers})).then((()=>{t(p),_(d)}));var e}),e,"Удаление...")})),Promise.all([c(s,"users/me",{method:"GET",headers:s.headers}),c(s,"cards",{method:"GET",headers:s.headers})]).then((([e,t])=>{!function(e){J.style=`background-image: url('${e.avatar}')`,j.textContent=e.name,D.textContent=e.about,C=e._id}(e),t.forEach((e=>{V(e,"append")}))})).catch((e=>{console.log(`Ошибка: ${e}`)}))})();