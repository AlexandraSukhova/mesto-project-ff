(()=>{"use strict";function e(e,t="popup_is-opened"){e.classList.toggle(t),document.addEventListener("keydown",n)}function t(e,t="popup_is-opened"){e.classList.toggle(t),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function o(e){return e.ok?e.json():Promise.reject(e.status)}function r(e,t,n="Сохранить",o="Сохранение..."){t.textContent=e?o:n}function a(e,t,n="Сохранение..."){t.preventDefault();const o=t.submitter,a=o.textContent;r(!0,o,a,n),e().then((()=>t.target.reset())).catch((e=>{console.log(`Ошибка: ${e}`)})).finally((()=>r(!1,o,a)))}const s={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"d997cce7-ebe0-4725-9847-92653316575c","Content-Type":"application/json"}};function c(e,t,n){return fetch(`${e.baseUrl}/`+t,n).then(o)}const i=e=>c(s,"cards/likes/"+e,{method:"PUT",headers:s.headers}),l=e=>c(s,"cards/likes/"+e,{method:"DELETE",headers:s.headers});let u;const d=document.querySelector(".popup_type_confirm"),p=document.querySelector("#card-template").content;function m(e){document.getElementById(e).remove()}function _(e,t,n){e.classList.contains("card__like-button_is-active")?l(t).then((t=>{e.classList.remove("card__like-button_is-active"),n.textContent=t.likes.length})).catch((e=>{console.log(`Ошибка: ${e}`)})):e.classList.contains("card__like-button")&&i(t).then((t=>{e.classList.add("card__like-button_is-active"),n.textContent=t.likes.length})).catch((e=>{console.log(`Ошибка: ${e}`)}))}const v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},f=(e,t)=>Array.from(e.querySelectorAll(t)),y=(e,t)=>{const n=e.querySelector(t.submitButtonSelector),o=f(e,t.inputSelector);o.forEach((n=>{h(n,e,t)})),b(o,n,t)},h=(e,t,n)=>{const o=t.querySelector(`.${e.id}-error`);e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},S=(e,t)=>{e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?h(e,t,v):((e,t,n,o)=>{const r=t.querySelector(`.${e.id}-error`);e.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n})(e,t,e.validationMessage,v)};function b(e,t,n){!function(e){return e.some((e=>!e.validity.valid))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}let k;const C=document.querySelector(".places__list"),E=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__edit-button"),L=document.querySelector(".popup__image"),q=document.querySelector(".popup__caption"),x=document.querySelector(".popup_type_edit"),B=document.querySelector(".popup_type_new-card"),T=document.querySelector(".popup_type_image"),$=document.forms["new-place"],w=$.elements["place-name"],A=$.elements.link,P=document.forms["edit-profile"],M=P.elements.name,N=P.elements.description,O=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),D=document.querySelector(".profile__image"),I=document.querySelector(".popup_type_update_avatar"),J=document.forms["update-avatar"],U=J.elements["avatar-link"];(e=>{f(document,e.formSelector).forEach((t=>{((e,t)=>{const n=f(e,t.inputSelector),o=e.querySelector(t.submitButtonSelector);b(n,o,t),n.forEach((r=>{r.addEventListener("input",(()=>{S(r,e),b(n,o,t)}))}))})(t,e)}))})(v);const G={deleteCard:m,likeCard:_,openedImageModal:function(t,n){L.src=t,L.alt=n,q.textContent=n,e(T)}};function H(t,n="prepend"){const o=function(t,n,o){const r=p.querySelector(".places__item").cloneNode(!0),a=r.querySelector(".card__image"),s=r.querySelector(".card__title"),c=r.querySelector(".like-number"),i=r.querySelector(".card__like-button"),l=r.querySelector(".card__delete-button"),m=i.querySelector(".like-number"),v=t.likes,f=t.owner._id;return a.src=t.link,a.alt=t.name,s.textContent=t.name,c.textContent=t.likes.length,function(e,t,n){e===n&&(t.hidden=!1)}(f,l,o),v.forEach((e=>function(e,t,n,o="card__like-button_is-active"){e===t&&n.classList.add(o)}(e._id,o,i))),i.addEventListener("click",(()=>_(i,t._id,m))),l.addEventListener("click",(()=>{u=t._id,r.id=u,e(d)})),a.addEventListener("click",(()=>n.openedImageModal(t.link,t.name))),r}(t,G,k);C[n](o)}D.addEventListener("click",(()=>{J.reset(),y(J,v),e(I)})),g.addEventListener("click",(()=>{M.value=O.textContent,N.value=j.textContent,y(P,v),e(x)})),E.addEventListener("click",(()=>{$.reset(),y($,v),e(B)}));const V={atCross:"popup__close",atBackdrop:"popup"};Array.from(document.querySelectorAll(".popup")).forEach((e=>function(e,n){e.addEventListener("click",(o=>{(o.target.classList.contains(n.atCross)||o.target.classList.contains(n.atBackdrop))&&t(e)}))}(e,V))),B.addEventListener("submit",(function(e){a((function(){return(e=w.value,n=A.value,c(s,"cards",{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:n})})).then((e=>(H(e),void t(B))));var e,n}),e,"Созданение...")})),x.addEventListener("submit",(function(e){a((function(){return(e=M.value,n=N.value,c(s,"users/me",{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:n})})).then((e=>{return n=e.name,o=e.about,O.textContent=n,j.textContent=o,void t(x);var n,o}));var e,n}),e)})),I.addEventListener("submit",(function(e){a((function(){return(e=U.value,c(s,"users/me/avatar",{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})})).then((e=>{return n=e.avatar,D.style=`background-image: url('${n}')`,void t(I);var n}));var e}),e)})),d.addEventListener("submit",(function(e){a((function(){return(e=u,c(s,"cards/"+e,{method:"DELETE",headers:s.headers})).then((()=>{t(d),m(u)}));var e}),e,"Удаление...")})),Promise.all([c(s,"users/me",{method:"GET",headers:s.headers}),c(s,"cards",{method:"GET",headers:s.headers})]).then((([e,t])=>{console.log(t),function(e){D.style=`background-image: url('${e.avatar}')`,O.textContent=e.name,j.textContent=e.about,k=e._id}(e),t.forEach((e=>{H(e,"append")}))})).catch((e=>{console.log(`Ошибка: ${e}`)}))})();